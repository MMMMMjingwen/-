<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>转盘</title>
	
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/component.css" rel="stylesheet" type="text/css">
    <link href="css/award.css" rel="stylesheet" type="text/css">
    <!-- <link rel="stylesheet" type="text/css" href="css/animate.min.css"/> -->
    <script>
        var html = document.querySelector('html');
        changeRem();
        window.addEventListener('resize', changeRem);

        function changeRem() {
            var width = html.getBoundingClientRect().width;
            html.style.fontSize = width / 10 + 'px';
        }
    </script>
	 <style>
  .banner .turnplate canvas.item {
    width: 89%;
    position: absolute;
    top: 8vw;
	left: 4.5%;
    /* margin-top: -102%;
    margin-left: 3%; */

    /* width: 88%;
    position: absolute;
    margin-top: -20.6rem;
    margin-left: 0.6rem; */
}
.banner .turnplate #tupBtn {
    position: absolute;
    width: 26.5%;
    height: 28.5%;
    left: 35.5%;
    top: 28vw;
    border: 0;
    background: none;
}
.kePublic {
	width: 80%;
	height: auto;
	position: absolute;
	top: 24vw;
	left: 10%;
	z-index: 99;
}

/* 中奖类型 */
.zjs{
    background-image: url(./imgs/jp.png);
    width: 90vw;
    height: 96vw;
    position: absolute;
    top: 48vw;
    left: -3vw;
    line-height: 8vw;
    font-size: 3vw;
    color: #EECFCF;
    text-align: center;
    border-radius: 20px;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    z-index: 99999;
    background-size: 95% 99%;
    background-repeat: no-repeat
}
/* 滚动 */
.record_line {
    background-image: url(./imgs/md.png);
    left: 0rem;
    width: 102%;
    height: 51%;
    /* min-width: 1000px; */
    z-index: -10;
    /* zoom: 1; */
    background-size: 100% 100%;
    background-repeat: no-repeat;
    /* background-size: cover; */
    /* -webkit-background-size: cover; */
    -o-background-size: cover;
    /* background-position: center 0; */
    /* position: relative; */
    width: 100%;
    height: 14vw;
    position: absolute;
    margin-bottom: 11rem;
    top: 147vw;

}
.lucky{
    color:#fff;
    position: absolute;
    margin-top: 26%;
    margin-left: 16%;
}
.lucky div{
    text-align: left;
}
.lucky .jx{
    margin-left: 10%
}
ul,li{ padding:0;margin:0;list-style:none; }
ul{
    text-align: left;  
}
.tj li{
  position: relative;
  margin-top: -5%;
  
}
.tj li a{
color:#fff;
    position: absolute;
    margin-left: 280%;
    text-decoration:none;
}
.tj li span{
    position: absolute;
    margin-left: 66%;
}
.all{
    position: absolute;
    /* margin-top: 12%; */
    margin-left: 174%;
    text-align: left;
}
.all .jx{
    display: block;
    margin-left: 10px;

}
.other{
    position: absolute;
    margin-top: 125%;
    margin-left: -3%;
}
#list li a{
    text-decoration: none;
    /* color: #007aff; */
    color: #fff;
    font-size: 2%
}

            .box{
    height: 30px;
    margin: 2% auto;
    overflow: hidden;
            }
            .box ul li{
                height:30px;
                text-align:center;
                line-height:30px;
            }



	</style> 
</head>
<body style='overflow-y:scroll; background-color:#fbc600;'>
<!-------------抽奖页面-------------->
<div style='overflow:scroll;' >
	<div  id="ml-main"  >
            <img src="./imgs/logo.png" style='
            z-index: 999999;
            position: relative;
            width: 22%;
            margin-top: 6%;
            margin-left: 6%;' >
		<img class="main_back" src="imgs/zpbg.png"/>
     
        <div class="kePublic">
            <!--转盘效果开始-->
            <div style="margin:-22% auto">
                <div class="banner">
                    <div class="turnplate">
                        <img src="./imgs/big.png" style=   ' width: 124%;
                        margin-left: -16%;
                        margin-top: -5%;'>
                        <canvas class="item" id="wheelcanvas" width="516" height="516"></canvas>
                        <img id="tupBtn" class="pointer" src="imgs/cjzz.png"/>
                        
                    </div>

                </div>
            </div>
            <!--转盘效果结束-->
            <div class="clear"></div>
            <div class="zjs">
                   
              <div class="lucky">
                    <ul  class='tj'>
                        <li>特等奖： <span>马尔代夫5日游</span> <a href="#">1名</a></li>
                        <li>一等奖： <span>Apple iphoneXR</span> <a href="#">2名</a></li>
                        <li>二等奖： <span>车载冰箱一套 </span><a href="#">10名</a></li>
                        <li>三等奖： <span>行车记录仪</span><a href='#'>50名</a></li>
  
                        
                    </ul>
                    <div style='position: relative;'> 
                        <div class='other'>其他奖品：</div>
                        <ul class='all'>
                            <li>车载充电器</li>
                            <li> 自拍杆</li>
                            <li>车载手机支架</li>
                            <li>汪正摄影免费全家福</li>
                            <li>酒仙网-酒卡</li>       
                        </ul>
                    </div>
                    
          

             </div>

 
           
            
        </div>
 
    
        <!--------------滚动中奖纪录---------------->
        <div class="record_line"  >
                <div class="box" id="box">
                        <ul id="list">
                            <li><a href="">恭喜  159****3540  的用户抽中 马尔代夫5日游</a></li>
                            <li><a href="">恭喜   135****6432  的用户抽中 车载充电器</a></li>
                            <li><a href="">恭喜  189****6432  的用户抽中 车载手机支架</a></li>
                            <li><a href="">恭喜  134****3500  的用户抽中 自拍杆</a></li>
                            <li><a href="">恭喜  139****3540  的用户抽中 汪正摄影免费全家福</a></li>
                            <li><a href="">恭喜   135****7856  的用户抽中 酒仙网-酒卡</a></li>
                            <li><a href="">恭喜  160****6432  的用户抽中 Apple iphoneXR</a></li>
                            <li><a href="">恭喜  134****3500  的用户抽中 车载充电器</a></li>
                            <li><a href="">恭喜  159****3540  的用户抽中 马尔代夫5日游</a></li>
                            <li><a href="">恭喜   135****6432  的用户抽中 行车记录仪</a></li>
                            <li><a href="">恭喜  189****6432  的用户抽中 车载充电器</a></li>
                            <li><a href="">恭喜  134****3500  的用户抽中 马尔代夫5日游</a></li>
                         
                        </ul>
                    </div>
        </div>
    
	</div>

</div> 
 
    
    <!-------------谢谢参与弹窗-------------->
    <div class="xxcy-main" id="xxcy-main">
    	<div class="xxcy">
        	<div class="xxcy_text">
        		很遗憾<br>没有抽中礼品
        	</div>   
        	<div class="close_xxcy">关闭</div>
        </div>
    </div>

 <input type="hidden" id='num'> 
 <input type="hidden" id='chinese'> 
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/mui.min.js"></script>
<script type="text/javascript" src="js/awardRotate.js"></script>
<script type="text/javascript" src="./js/layui-v2.4.5/layui/layui.js"></script>
<!-- <script type="text/javascript" src="js/award.js"></script> -->
<script>
//弹窗
layui.use('layer', function(){
  var layer = layui.layer;
  
});              
     
function family() {

// console.log('是家庭啊')
layer.open({
    type: 2
    ,title: false //不显示标题栏
    ,closeBtn: false
    ,area: ['80%','90%']
    ,content: './family.html'
    ,success: function(layero){
   

    }
  });   


}

function grape(){
layer.open({
    type: 2
    ,title: false //不显示标题栏
    ,closeBtn: false
    ,area: ['80%','80%']
    ,scrollbar:false
    ,content: './grape.html'
    ,success: function(layero){
    //   var btn = layero.find('.layui-layer-btn');

    //   btn.find('.layui-layer-btn0').attr({
    //     href: './draw.html'
    //     // ,target: '_blank'
    //   });

    }
  });  


}

function getStyle(element,attr){
    if(element.currentStyle){
        return element.currentStyle[attr];
    }else{
        return getComputedStyle(element,false)[attr];
    }
}

var s = {
    mt:0,  //初始移动距离
    moveDuration:30,  //移动间隔
    stopDuration:4000, //停止间隔
    init:function(){   
        var list = document.getElementById("list"),
              li = list.getElementsByTagName("li")[0],
             firstLi = list.children[0].cloneNode(true),
             liHeight = parseInt(getStyle(li ,"height")),  
             liLen = list.children.length, 
             mtTotal = liHeight*liLen;
        list.appendChild(firstLi)
        setInterval(function(){
            var timer = setInterval(function(){
                s.mt-=1;
                if(s.mt == -mtTotal){
                    s.mt = 0;
                }
                list.style.marginTop = s.mt+"px";
                if(s.mt%liHeight == 0){
                    clearInterval(timer);
                }
            },s.moveDuration)
        },s.stopDuration)
    }
}

    s.init()


// var Mar = document.getElementById("box"); 
// var child_div=Mar.getElementsByTagName("a") 
var picH = 35;//移动高度 
var scrollstep=3;//移动步幅,越大越快 
var scrolltime=50;//移动频度(毫秒)越大越慢 
var stoptime=3000;//间断时间(毫秒) 
var tmpH = 0; 
// Mar.innerHTML += Mar.innerHTML; 
function start(){ 
   
if(tmpH < picH){ 
    tmpH += scrollstep; 
    if(tmpH > picH )tmpH = picH ; 
    // Mar.scrollTop = tmpH; 
    setTimeout(start,scrolltime); 
}else{ 
    tmpH = 0; 
    // Mar.appendChild(child_div[0]); 
    // Mar.scrollTop = 0; 
    setTimeout(start,stoptime); 
} 
}

//抽奖结束跳转的页面
 function jiu(){
   window.location.href='https://mmarket.jiuxian.com/draw/getDetail/871511e8-02c2-4598-9d36-e264c3544c82'
 }

 function photo(){
    window.location.href='http://m.huashenghaoche.com'
 }




 var turnplate={
    restaraunts:[],				//大转盘奖品名称
    colors:[],	                //大转盘奖品区块对应背景颜色
    outsideRadius:235,			//大转盘外圆的半径
    textRadius:155,				//大转盘奖品位置距离圆心的距离
    insideRadius:75,			//大转盘内圆的半径
    startAngle:0,             	//开始角度
    bRotate:false	,			//false:停止;ture:旋转

};


$(function(){
    $("img").on("click",function(){
		return false;
    });
    document.addEventListener("WeixinJSBridgeReady",function(){
		WeixinJSBridge.call('hideOptionMenu'); 
    });

    var sss=sessionStorage.getItem('iphone');
    // console.log(sss+'<<<<<<<<<<<<')
    $.ajax({
        type:"get",
        url:"/apis/draw/random?phone=sss",
        data:"",
        dataType:"json",
        success:function(data){
            console.log(data);
            $('#num').val(data)
            if(data==8){
                $('#chinese').val('汪正免费摄影全家福')
            }else if(data==10){
            $('#chinese').val('酒仙网-酒卡')
            }
            //获取随机数(奖品个数范围内)
            // var item = data.index;
            //奖品数量等于10,指针落在对应奖品区域的中心角度[252, 216, 180, 144, 108, 72, 36, 360, 324, 288]
            // rotateFn(item, turnplate.restaraunts[item-1],data);
        },
        error:function(data){
            console.log("error:"+data);
            return;
        }
    });

    // $(document).ready(function(){

        // setTimeout(start,stoptime);
        
        //动态添加大转盘的奖品与奖品区域背景颜色
        var num=location.hash;//根据接收过来的值判断概率。
            // alert(num.substr(1));
        // turnplate.fontcolors = ["#000", "#000", "#000", "#000", "#000", "#000", "#000", "#000", "#000", "#000"];
        turnplate.restaraunts = [ "马尔代夫5日游", "iphoneXR", "车载冰箱", "行车记录仪", "车载充电器","自拍杆","车载手机支架","全家福", "谢谢参与",'酒仙网-酒卡'];
        turnplate.colors = ["rgb(255,238,166)", "rgb(255,209,25)", "rgb(253,197,120)", "rgb(255,238,166)", "rgb(255,209,25)", "rgb(253,197,120)","rgb(255,238,166)", "rgb(255,209,25)", "rgb(253,197,120)","rgb(255,209,25)",];
      
        var rotateTimeOut = function (){
            $('#wheelcanvas').rotate({
                angle:0,
                animateTo:2160,
                duration:6000,
                callback:function (){
                    alert('网络超时，请检查您的网络设置！');
                }
            });
        };
        
        
        //旋转转盘 item:奖品位置; txt：提示语;
        var rotateFn = function (item, txt,data){
            var angles = item * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length*2));
            if(angles<270){
                angles = 270 - angles; 
            }else{
                angles = 360 - angles + 270;
            }
            $('#wheelcanvas').stopRotate();
            $('#wheelcanvas').rotate({
                angle:0,
                animateTo:angles+1800,
                duration:6000,
                callback:function (){
                    //中奖页面与谢谢参与页面弹窗
                    if(txt.indexOf("谢谢参与")>=0){
                        $(".xxcy_text").html('谢谢参与');
                        $("#xxcy-main").fadeIn();
                        save();

                    }  else if(txt.indexOf("全家福")>=0){
                        sessionStorage.removeItem('user')
                    sessionStorage.removeItem('iphone')
                        family()
                        
                    }else  if(txt.indexOf("酒仙网-酒卡")>=0){
                        sessionStorage.removeItem('user')
               sessionStorage.removeItem('iphone')
                        grape()
                    }else{
                      
                    }								
                    turnplate.bRotate = !turnplate.bRotate;
                }
            });
        };
        
        /********弹窗页面控制**********/
        
        // $('.close_zj').click(function(){
        //     window.location.reload();
        //     $('#zj-main').fadeOut();
        //     $('#tx-main').fadeIn();//提醒框显示
        //     //判断用户是否确认放弃
        //     $(".do").click(function(){//点确认就默认放弃
        //         $('#tx-main').fadeOut();
        //         theEnd();
        //         save();
        //     });
        //     $(".not_do").click(function(){//点取消就回到提交页面
        //         $('#tx-main').fadeOut();
        //         $('#zj-main').fadeIn();
        //     });
        
        //     $('#ml-main').fadeIn();
            
        // });
        
        $('.close_xxcy').click(function(){
            $('#xxcy-main').fadeOut();
            window.location.reload();
        //		theEnd();
        //		save();
        });
        
        /********抽奖开始**********/
        $('#tupBtn').click(function (){

            var c=$('#num').val()
            if(c==-1){
                $(".xxcy_text").html("今日抽奖次数已用完");
                $("#xxcy-main").fadeIn();
                return;
            }
            rotateFn(c, turnplate.restaraunts[c-1],data);
            return;
         
        		if(gameState != 0){
        			$(".xxcy_text").html("活动时间：01.13-03.04");
        			$("#xxcy-main").fadeIn();
        			return;	
        		}
            if(gamed == 1){
                $(".xxcy_text").html("今日抽奖次数已用完<br>每天分享可以增加一次抽奖机会");
                $("#xxcy-main").fadeIn();
                return;
            }
            if(turnplate.bRotate)return;
            turnplate.bRotate = !turnplate.bRotate;
            var item = 9;
            var data = {"msg":"谢谢参与"};
            rotateFn(item, turnplate.restaraunts[item-1],data);
        		// $.ajax({
        		// 	type:"get",
        		// 	url:"/apis/sms/draw/random",
        		// 	data:"",
        		// 	dataType:"json",
        		// 	success:function(data){
        		// 		console.log(data);
        		// 		//获取随机数(奖品个数范围内)
        		// 		var item = data.index;
        		// 		//奖品数量等于10,指针落在对应奖品区域的中心角度[252, 216, 180, 144, 108, 72, 36, 360, 324, 288]
        		// 		
        		// 	},
        		// 	error:function(data){
        		// 		console.log("error:"+data);
        		// 		return;
        		// 	}
        		// });
        })
            
     
})


function rnd(n, m){
var random = Math.floor(Math.random()*(m-n+1)+n);
return random;
}

//页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染
window.onload=function(){
drawRouletteWheel();
};

function drawRouletteWheel() {    
var canvas = document.getElementById("wheelcanvas");    
if (canvas.getContext) {
  //根据奖品个数计算圆周角度
  var arc = Math.PI / (turnplate.restaraunts.length/2);
  var ctx = canvas.getContext("2d");

  //在给定矩形内清空一个矩形
  ctx.clearRect(0,0,536,536);
  //strokeStyle 属性设置或返回用于笔触的颜色、渐变或模式  
  ctx.strokeStyle = "rgb(245,198,68)";

  //font 属性设置或返回画布上文本内容的当前字体属性
  ctx.font = 'bold 20px 微软雅黑 ';  
//   turnplate.fontcolors='blue'
  for(var i = 0; i < turnplate.restaraunts.length; i++) {       
      var angle = turnplate.startAngle + i * arc;
      ctx.fillStyle = turnplate.colors[i];
      ctx.beginPath();
      //arc(x,y,r,起始角,结束角,绘制方向) 方法创建弧/曲线（用于创建圆或部分圆）    
      ctx.arc(258, 258, turnplate.outsideRadius, angle, angle + arc, false);    
      ctx.arc(258, 258, turnplate.insideRadius, angle + arc, angle, true);
      ctx.stroke();  
      ctx.fill();
      //锁画布(为了保存之前的画布状态)
      ctx.save();   
      
      //----绘制奖品开始----
      ctx.fillStyle = "#000";
      //ctx.fillStyle = turnplate.fontcolors[i];
      var text = turnplate.restaraunts[i];
      var line_height = 20;
      //translate方法重新映射画布上的 (0,0) 位置
      ctx.translate(258 + Math.cos(angle + arc / 2) * turnplate.textRadius, 258 + Math.sin(angle + arc / 2) * turnplate.textRadius);
      ctx.lineWidth = 2;
  ctx.strokeStyle = "rgb(250,117,16)";
      ctx.stroke();//绘制
      //rotate方法旋转当前的绘图
      ctx.rotate(angle + arc / 5 + Math.PI / 15);
      
      /** 下面代码根据奖品类型、奖品名称长度渲染不同效果，如字体、颜色、图片效果。(具体根据实际情况改变) **/
      if(text.indexOf("\n")>0){//换行
          var texts = text.split("\n");
          for(var j = 0; j<texts.length; j++){
              ctx.font = j == 0?'20px Microsoft YaHei':'20px Microsoft YaHei';
              ctx.strokeStyle = "#000";
            //   ctx.fillStyle = j == 0?'#FFFFFF':'#FFFFFF';
              if(j == 0){
                //   ctx.fillText(texts[j]+"M", -ctx.measureText(texts[j]+"M").width / 2, j * line_height);
                  ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 3, j * line_height);
              }else{
                  ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 3, j * line_height);
              }
          }
      }else if(text.indexOf("\n") == -1 && text.length>6){//奖品名称长度超过一定范围 
          text = text.substring(0,6)+"||"+text.substring(6);
          var texts = text.split("||");
          for(var j = 0; j<texts.length; j++){
              ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
          }
      }else{

          //在画布上绘制填色的文本。文本的默认颜色是黑色
          //measureText()方法返回包含一个对象，该对象包含以像素计的指定字体宽度
          ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
      }
      
      //把当前画布返回（调整）到上一个save()状态之前 
      ctx.restore();
      //----绘制奖品结束----
  }     
} 


// 对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器
/*var useragent = navigator.userAgent;
if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {
    // 这里警告框会阻塞当前页面继续加载
    alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');
    // 以下代码是用javascript强行关闭当前页面
    var opened = window.open('about:blank', '_self');
    opened.opener = null;
    opened.close();
}*/


}

function showDialog(id) {
document.getElementById(id).style.display = "-webkit-box";
}

function showID(id) {    
document.getElementById(id).style.display = "block";  
}
function hideID(id) {
document.getElementById(id).style.display = "none";
}

//缓存函数
function save() {
    console.log('缓存')
localStorage.end=theEnd();
localStorage.gifts=$(".cjjg").text();
}

//提示抽奖结束
function theEnd() {
$('#tupBtn').unbind('click');//提交成功解除点击事件。   
return 2;
}

//刷新页面
function  wload(){
    window.location.reload();
}

</script>
</body>
</html>
